id: org.wine.App
branch: stable
sdk: org.wine.Sdk
runtime: org.wine.Platform
runtime-version: '10.0'
finish-args:
  - --allow=multiarch               # Access to 32bit libraries (for running 32bit executables)
  - --socket=wayland                # Access to Wayland socket for display
  - --socket=fallback-x11           # Access to X11 socket for display (incase wayland doesn't work)
  - --socket=pulseaudio             # Access to pulse audio socket for sound
  - --env=WINEPREFIX=/var/data/wine # Set prefix location
  # - --env=WINEARCH=win32            # Set Wine to 32bit mode (64bit mode is default)
# inherit-extensions:
#   - org.freedesktop.Platform.Compat.i386
#   - org.freedesktop.Platform.GL32
#   - org.freedesktop.Platform.ffmpeg-full
#   - org.freedesktop.Platform.ffmpeg_full.i386
x-gl-version: &gl-version '1.4'
x-gl-versions: &gl-versions 24.08;1.4
x-gl-merge-dirs: &gl-merge-dirs vulkan/icd.d;glvnd/egl_vendor.d;egl/egl_external_platform.d;OpenCL/vendors;lib/dri;lib/d3d;lib/gbm;vulkan/explicit_layer.d;vulkan/implicit_layer.d
add-extensions:
  org.freedesktop.Platform.Compat.i386:
    directory: lib/i386-linux-gnu
    version: '24.08'

  org.freedesktop.Platform.Compat.i386.Debug:
    directory: lib/debug/lib/i386-linux-gnu
    version: '24.08'
    no-autodownload: true

  org.freedesktop.Platform.GL32:
    directory: lib/i386-linux-gnu/GL
    version: *gl-version
    versions: *gl-versions
    subdirectories: true
    no-autodownload: true
    autodelete: false
    add-ld-path: lib
    merge-dirs: *gl-merge-dirs
    download-if: active-gl-driver
    enable-if: active-gl-driver
    autoprune-unless: active-gl-driver

  org.freedesktop.Platform.GL32.Debug:
    directory: lib/debug/lib/i386-linux-gnu/GL
    version: *gl-version
    versions: *gl-versions
    subdirectories: true
    no-autodownload: true
    merge-dirs: *gl-merge-dirs
    enable-if: active-gl-driver
    autoprune-unless: active-gl-driver
cleanup-commands:
  - mkdir -p ${FLATPAK_DEST}/lib/i386-linux-gnu
  - mkdir -p ${FLATPAK_DEST}/lib/debug/lib/i386-linux-gnu
modules:
  - name: App
    buildsystem: simple
    sources:
      - type: file
        path: org.wine.App.metainfo.xml
    build-commands:
      - |
        install -Dm644 org.wine.App.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo
        echo "ew"
